# SingAlong

AstrBot 歌词接龙插件，当你发送一句歌词，机器人会回复下一句。

## 功能特点

- 支持本地歌词库，用户可自定义添加歌词
- 支持网易云音乐、QQ 音乐、酷狗音乐三大平台歌词检索
- 优化的歌词匹配算法，提高识别准确率
- 歌词文件自动过滤，保持纯净的歌词内容
- 智能语言检测，英文歌词和中文歌词分别处理
- 智能歌词预处理，支持忽略QQ表情、emoji和标点符号进行匹配
- 支持歌词管理面板（单独项目）

## 版本更新

### v1.2.2 (2025-07-21)

- ✨ **新增功能**: 添加可选导入默认歌词库功能
- 🔧 **配置优化**: 新增`auto_import_default_lyrics`配置项，可设置是否自动导入默认歌词库
- 🛠️ **用户体验**: 修改默认模糊匹配度为0.85

### v1.2.1 (2025-07-14)

- 🔄 **重要改进**: 歌词数据迁移到用户持久化目录
- 📁 **数据安全**: 歌词文件现存储在 `data/lyrics_data` 目录，插件更新时不会丢失
- ⚡ **自动迁移**: 插件启动时自动将默认歌词文件增量迁移到用户目录
- 🛡️ **数据保护**: 迁移过程不会覆盖用户已有的歌词文件

### v1.2.0 (2025-07-14)

- ✨ **新增功能**: 添加删除歌词指令
- 📚 **文档改进**: 更新 README 文档，修正版本更新记录 lint
- 🔧 **技术改进**: 指令 `/lyric` 改为 `/lyrics`

### v1.1.1 (2025-06-17)

- 🐛 **修复QQ表情支持**: 改进歌词预处理功能，支持忽略QQ表情和emoji进行歌词匹配(带着情绪唱歌吧)
- 🐛 **修复消息过滤问题**: 修复QQ表情(`face`类型)被错误过滤导致无法匹配的问题
- 🔧 **技术改进**: 增强歌词预处理逻辑

### v1.1.0 (2025-06-16)

- 🐛 **修复配置文件读取 bug**: 迁移到 AstrBot 标准配置系统，通过管理界面配置
- 🐛 **修复英文歌词处理 bug**: 添加智能语言检测，英文歌词不再被错误拆分
- ✨ **新增功能**: 支持歌词管理面板（单独仓库）
- 📚 **文档改进**: 更新配置说明和使用指南

### v1.0.0

- 🎉 初始版本发布
- ✨ 基础歌词接龙功能
- ✨ 多平台歌词搜索
- ✨ 批量下载工具

## 使用方法

### 基本功能

1. **歌词接龙**: 直接发送歌词，机器人会匹配并回复下一句
2. **搜索歌词**: `/lyrics search <歌名> [歌手名] [音乐源]` - 搜索并添加歌词到歌词库
3. **查看列表**: `/lyrics list` - 列出所有已添加的歌曲
4. **查看歌词**: `/lyrics view <歌曲名>` - 查看指定歌曲的完整歌词内容
5. **删除歌词**: `/lyrics delete <歌曲名>` - 从歌词库中删除指定歌曲
6. **重新加载**: `/lyrics reload` - 重新加载歌词库
7. **查看帮助**: `/lyrics help` - 查看详细使用帮助

### 搜索歌词参数

`/lyrics search` 命令支持以下几种参数输入方式：

- `/lyrics search 晴天` - 只指定歌名
- `/lyrics search 晴天 周杰伦` - 指定歌名和歌手名  
- `/lyrics search 晴天 周杰伦 QQ音乐` - 指定歌名、歌手名和音乐源

### 音乐源参数

在使用 `/lyrics search` 命令时，可以指定音乐源参数以精确搜索特定平台的歌词，支持的音乐源包括：

- `网易云`、`netease` - 从网易云音乐搜索歌词
- `QQ音乐`、`qq` - 从 QQ 音乐搜索歌词
- `酷狗`、`kugou` - 从酷狗音乐搜索歌词

例如：`/lyrics search 晴天 周杰伦 QQ音乐` 将从 QQ 音乐搜索周杰伦的《晴天》。

## 批量下载工具

### 自动下载歌手全部歌曲

如需批量下载某个歌手的所有歌曲，可以运行：

```bash
python tools/fetch_lyrics.py
```

该工具支持：

- 选择不同音乐平台（网易云、QQ 音乐、酷狗音乐）
- 批量下载指定歌手的所有歌曲歌词
- 自动过滤和保存纯净歌词文件

### 单独搜索歌曲

也可以单独运行搜索工具：

```bash
python tools/search_lyrics.py
```

用于单独搜索和下载特定歌曲的歌词。

## 数据存储

- 歌词文件存储在 `Astrbot/data/lyrics_data` 目录下（用户持久化数据目录）
- 插件首次启动时会自动将内置的默认歌词文件增量迁移到用户目录，不会覆盖已有文件
- 每首歌一个文本文件，经过智能过滤，只保留纯净的歌词内容
- 自动去除作词、作曲、编曲等信息行
- 智能语言检测：英文歌词保持完整，中文歌词支持空格拆分
- **数据安全**: 歌词数据存储在用户持久化目录，插件更新时不会丢失用户数据
- **重要**: 本仓库的歌词库仅作为示例，不再维护更新，建议使用独立的歌词数据仓库

## 配置选项

可通过 AstrBot 配置界面调整以下参数：

- `preprocess_lyrics`: 是否预处理歌词以提高匹配准确率
- `match_threshold`: 歌词匹配阈值,默认 0.8（0.1-1.0，越高越精确）

## 相关项目

### 歌词管理面板

为了更好的歌词管理体验，提供了独立的 Web 管理面板：

> **📝 管理面板仓库**: [EEEpai/astrbot_plugin_lyricnext_admin](https://github.com/EEEpai/astrbot_plugin_lyricnext_admin)
>
> 功能特点：
>
> - 可视化歌词库管理
> - 歌词搜索和预览
> - 批量操作支持
> - 歌词质量检测

### 歌词数据仓库

提供预制的歌词数据库，方便快速部署：

> **🎵 歌词数据仓库**: [EEEpai/astrbot_plugin_lyricnext_lyrics](https://github.com/EEEpai/astrbot_plugin_lyricnext_lyrics)
>
> 说明：
>
> - 包含精选歌词数据
> - 定期更新歌词库
> - 本插件仓库的歌词库不再更新

## 重要说明

- **歌词库更新**: 本仓库的 `data/lyrics` 目录不再维护更新，请关注独立的歌词数据仓库
- **管理面板**: 推荐使用独立的管理面板项目进行歌词管理
- **数据备份**: 迁移插件时请注意备份您的歌词数据

---

![img.png](.github/img.png)

---

![img.png](.github/img_1.png)
